-- Database: noon_report_pro
-- Export Time: 2026/2/2 11:38:38

-- Table: ship_last_receive_record
CREATE TABLE `ship_last_receive_record` (
  `ship_code` varchar(50) NULL,
  `dt` date NULL,
  `max_time_str` varchar(19) NULL
) ENGINE=OLAP
UNIQUE KEY(`ship_code`, `dt`)
COMMENT '船舶数据统计表(天)'
DISTRIBUTED BY HASH(`dt`) BUCKETS 10
PROPERTIES (
"replication_allocation" = "tag.location.default: 1",
"min_load_replica_num" = "-1",
"is_being_synced" = "false",
"storage_medium" = "hdd",
"storage_format" = "V2",
"inverted_index_storage_format" = "V1",
"enable_unique_key_merge_on_write" = "true",
"light_schema_change" = "true",
"disable_auto_compaction" = "false",
"enable_single_replica_compaction" = "false",
"group_commit_interval_ms" = "10000",
"group_commit_data_bytes" = "134217728",
"enable_mow_light_delete" = "false"
);

-- Table: noon_report_mail_status
CREATE TABLE `noon_report_mail_status` (
  `ship_code` varchar(50) NULL COMMENT "船舶代码",
  `first_data_utctime` datetime NULL COMMENT "窗口开始",
  `last_data_utctime` datetime NULL COMMENT "窗口结束",
  `report_date` varchar(50) NULL COMMENT "报告日期",
  `sent_status` int NULL DEFAULT "0" COMMENT "发送状态: 0-失败, 1-成功",
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT "创建时间",
  `update_time` datetime NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT "更新时间"
) ENGINE=OLAP
UNIQUE KEY(`ship_code`, `first_data_utctime`)
COMMENT '午报发送状态表'
DISTRIBUTED BY HASH(`ship_code`) BUCKETS 10
PROPERTIES (
"replication_allocation" = "tag.location.default: 1",
"min_load_replica_num" = "-1",
"is_being_synced" = "false",
"storage_medium" = "hdd",
"storage_format" = "V2",
"inverted_index_storage_format" = "V1",
"enable_unique_key_merge_on_write" = "true",
"light_schema_change" = "true",
"disable_auto_compaction" = "false",
"enable_single_replica_compaction" = "false",
"group_commit_interval_ms" = "10000",
"group_commit_data_bytes" = "134217728",
"enable_mow_light_delete" = "false"
);

-- Table: dim_ship_basic_info_d
CREATE TABLE `dim_ship_basic_info_d` (
  `ship_code` varchar(64) NOT NULL COMMENT "船舶编号",
  `ship_name_cn` varchar(100) NULL COMMENT "船舶中文名",
  `ship_name_en` varchar(100) NULL COMMENT "船舶英文名",
  `ship_class` varchar(100) NULL COMMENT "船舶级别",
  `ship_type` varchar(100) NULL COMMENT "船舶类型",
  `data_source` varchar(100) NULL COMMENT "数据来源",
  `no1_dg_rated_power` decimal(10,3) NULL COMMENT "1号发电机额定功率(kW)",
  `no2_dg_rated_power` decimal(10,3) NULL COMMENT "2号发电机额定功率(kW)",
  `no3_dg_rated_power` decimal(10,3) NULL COMMENT "3号发电机额定功率(kW)",
  `no4_dg_rated_power` decimal(10,3) NULL COMMENT "4号发电机额定功率(kW)",
  `rated_speed` decimal(10,3) NULL COMMENT "额定转速（r/min）",
  `pitch` decimal(10,3) NULL COMMENT "pitch",
  `dwg` decimal(10,3) NULL COMMENT "载重吨",
  `project_id` int NULL COMMENT "项目id",
  `report_type` int NULL COMMENT "报告类型 0是计算午报，1是计算日报",
  `customer_name` varchar(100) NULL COMMENT "客户名称",
  `calc_threshold` int NULL DEFAULT "250" COMMENT "触发计算阈值 默认250",
  `update_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT "入库时间",
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT "入库时间"
) ENGINE=OLAP
UNIQUE KEY(`ship_code`)
COMMENT '船舶基础信息表'
DISTRIBUTED BY HASH(`ship_code`) BUCKETS 8
PROPERTIES (
"replication_allocation" = "tag.location.default: 1",
"min_load_replica_num" = "-1",
"is_being_synced" = "false",
"storage_medium" = "hdd",
"storage_format" = "V2",
"inverted_index_storage_format" = "V1",
"enable_unique_key_merge_on_write" = "true",
"light_schema_change" = "true",
"disable_auto_compaction" = "false",
"enable_single_replica_compaction" = "false",
"group_commit_interval_ms" = "10000",
"group_commit_data_bytes" = "134217728",
"enable_mow_light_delete" = "false"
);

-- Table: dws_noon_report_d
CREATE TABLE `dws_noon_report_d` (
  `ship_code` varchar(100) NULL COMMENT "船名（英文）",
  `noonreport_date` varchar(50) NULL COMMENT "报告日期",
  `first_data_utctime` datetime NULL COMMENT "当日原始数据第一条的时间（UTC）",
  `last_data_utctime` datetime NULL COMMENT "当日原始数据最后一条的时间（UTC）",
  `data_volume_day` int NULL COMMENT "当日原始数据点数（条）",
  `vessel_name` varchar(100) NULL COMMENT "船名（英文）",
  `vessel_name_cn` varchar(100) NULL COMMENT "船舶（中文）",
  `project_id` int NULL COMMENT "项目id 关联dim_ship_basic_info_d.project_id获取",
  `report_type` int NULL COMMENT "报告类型，关联dim_ship_basic_info_d.report_type获取",
  `report_length_hrs_soms` double NULL COMMENT "SOMS报告时长（小时）",
  `lon` double NULL COMMENT "经度（船位）",
  `lat` double NULL COMMENT "纬度（船位）",
  `time_zone` int NULL COMMENT "时区（船位）",
  `noonreport_lt` datetime NULL COMMENT "报告时间（LT）",
  `noonreport_utctime` datetime NULL COMMENT "报告时间（UTC）",
  `report_length_hrs` double NULL COMMENT "报告时长（小时）",
  `vessel_loading` varchar(50) NULL COMMENT "船舶载重",
  `observed_speed_nm_h` double NULL COMMENT "观测速度（对地）_nm_H",
  `observed_speed_kn` double NULL COMMENT "观测速度（对地）",
  `observed_speed_0_5kn` double NULL COMMENT "观测速度（对地）_0.5",
  `me_load` double NULL COMMENT "主机负荷",
  `me_cons_mt` double NULL COMMENT "主机日耗油量（吨）",
  `ae_cons_mt` double NULL COMMENT "发电机组总日耗油量（吨）",
  `boiler_cons_mt` double NULL COMMENT "锅炉总日耗油量（吨）",
  `total_fo_cons_mt` double NULL COMMENT "总日耗油量（吨）",
  `me_running_hours` double NULL COMMENT "主机总运行时长（小时）",
  `remarks_soms` varchar(500) NULL COMMENT "SOMS生成备注",
  `steaming_distance` double NULL COMMENT "航行距离",
  `steaming_time` double NULL COMMENT "航行时间（主机运行/定速）",
  `wind_speed_soms` double NULL COMMENT "风速-风速风向仪（相对）",
  `wind_diretion_soms` double NULL COMMENT "风向-风速风向仪（相对）",
  `wind_scale_bf` int NULL COMMENT "风力等级（BF）",
  `no1_dg_power` double NULL COMMENT "1号发电机功率",
  `no2_dg_power` double NULL COMMENT "2号发电机功率",
  `no3_dg_power` double NULL COMMENT "3号发电机功率",
  `no4_dg_power` double NULL COMMENT "4号发电机功率",
  `ae_no1_running_hours` double NULL COMMENT "1号发电机运行时间",
  `ae_no2_running_hours` double NULL COMMENT "2号发电机运行时间",
  `ae_no3_running_hours` double NULL COMMENT "3号发电机运行时间",
  `ae_no4_running_hours` double NULL COMMENT "4号发电机运行时间",
  `ae_no1_load` double NULL COMMENT "1号发电机负荷",
  `ae_no2_load` double NULL COMMENT "2号发电机负荷",
  `ae_no3_load` double NULL COMMENT "3号发电机负荷",
  `ae_no4_load` double NULL COMMENT "4号发电机负荷",
  `no1_dg_rated_power` double NULL COMMENT "1号发电机额定功率",
  `no2_dg_rated_power` double NULL COMMENT "2号发电机额定功率",
  `no3_dg_rated_power` double NULL COMMENT "3号发电机额定功率",
  `no4_dg_rated_power` double NULL COMMENT "4号发电机额定功率",
  `boiler_no_1_cons_mt` double NULL COMMENT "1号锅炉日耗油量",
  `boiler_no_1_running_hours` double NULL COMMENT "1号锅炉运行时间",
  `boiler_no_2_cons_mt` double NULL COMMENT "2号锅炉日耗油量",
  `boiler_no_2_running_hours` double NULL COMMENT "2号锅炉运行时间",
  `boiler_running_hours` double NULL COMMENT "锅炉运行时间",
  `observed_speed_realtime` double NULL COMMENT "实时速度（对地）",
  `heading` double NULL COMMENT "船艏向",
  `fore_draft` double NULL COMMENT "艏吃水",
  `aft_draft` double NULL COMMENT "艉吃水",
  `draft` double NULL COMMENT "平均吃水",
  `slip_rate` double NULL COMMENT "滑失率",
  `me_rpm` double NULL COMMENT "主机转速",
  `me_no1_exhaust_temp_max` double NULL COMMENT "主机1号气缸排气温度-最大值",
  `me_no2_exhaust_temp_max` double NULL COMMENT "主机2号气缸排气温度-最大值",
  `me_no3_exhaust_temp_max` double NULL COMMENT "主机3号气缸排气温度-最大值",
  `me_no4_exhaust_temp_max` double NULL COMMENT "主机4号气缸排气温度-最大值",
  `me_no5_exhaust_temp_max` double NULL COMMENT "主机5号气缸排气温度-最大值",
  `me_no6_exhaust_temp_max` double NULL COMMENT "主机6号气缸排气温度-最大值",
  `me_no7_exhaust_temp_max` double NULL COMMENT "主机7号气缸排气温度-最大值",
  `me_no1_exhaust_temp_min` double NULL COMMENT "主机1号气缸排气温度-最小值",
  `me_no2_exhaust_temp_min` double NULL COMMENT "主机2号气缸排气温度-最小值",
  `me_no3_exhaust_temp_min` double NULL COMMENT "主机3号气缸排气温度-最小值",
  `me_no4_exhaust_temp_min` double NULL COMMENT "主机4号气缸排气温度-最小值",
  `me_no5_exhaust_temp_min` double NULL COMMENT "主机5号气缸排气温度-最小值",
  `me_no6_exhaust_temp_min` double NULL COMMENT "主机6号气缸排气温度-最小值",
  `me_no7_exhaust_temp_min` double NULL COMMENT "主机7号气缸排气温度-最小值",
  `me_no1_exhaust_temp_mean` double NULL COMMENT "主机1号气缸排气温度-平均值",
  `me_no2_exhaust_temp_mean` double NULL COMMENT "主机2号气缸排气温度-平均值",
  `me_no3_exhaust_temp_mean` double NULL COMMENT "主机3号气缸排气温度-平均值",
  `me_no4_exhaust_temp_mean` double NULL COMMENT "主机4号气缸排气温度-平均值",
  `me_no5_exhaust_temp_mean` double NULL COMMENT "主机5号气缸排气温度-平均值",
  `me_no6_exhaust_temp_mean` double NULL COMMENT "主机6号气缸排气温度-平均值",
  `me_no7_exhaust_temp_mean` double NULL COMMENT "主机7号气缸排气温度-平均值",
  `sig_wave_hgt_wni` double NULL COMMENT "浪高_WNI",
  `wave_scale` varchar(50) NULL COMMENT "浪高等级_WNI",
  `current_velocity_wni` double NULL COMMENT "流速_WNI",
  `current_direction_wni` varchar(50) NULL COMMENT "流向_WNI (Going To)",
  `wave_direction_wni` varchar(50) NULL COMMENT "海浪方向_WNI (Coming From)",
  `wind_speed_wni` double NULL COMMENT "风速_WNI",
  `wind_direction_wni` varchar(50) NULL COMMENT "风向_WNI (Coming From)",
  `voyage_type` varchar(50) NULL COMMENT "航线种类",
  `course` double NULL COMMENT "航向",
  `me_output_power` double NULL COMMENT "主机输出功率",
  `voyage_no` varchar(100) NULL COMMENT "航次编号",
  `spd_theoretical` double NULL COMMENT "理论航速",
  `swell_wave_height_wni` double NULL COMMENT "涌浪高_WNI",
  `swell_wave_direction_wni` varchar(50) NULL COMMENT "涌浪方向_WNI (Coming From)",
  `sea_surface_pressure_wni` double NULL COMMENT "海面气压_WNI",
  `me_cons_mt_24h` double NULL COMMENT "主机日耗油量_24h（吨）",
  `ae_cons_mt_24h` double NULL COMMENT "发电机组总日耗油量_24h（吨）",
  `stw` double NULL COMMENT "对水速度",
  `me_work` double NULL COMMENT "主机功（kWh）",
  `total_battery_cons` double NULL COMMENT "电能总日消耗量 kWh",
  `no1_box_battery_cons` double NULL COMMENT "1#箱式电源耗电量 kWh",
  `no2_box_battery_cons` double NULL COMMENT "2#箱式电源耗电量 kWh",
  `no3_box_battery_cons` double NULL COMMENT "3#箱式电源耗电量 kWh",
  `no1_mp_power` double NULL COMMENT "1#主推电机功率 kW",
  `no1_mp_speed_rpm` double NULL COMMENT "1#主推电机转速 RPM",
  `no2_mp_power` double NULL COMMENT "2#主推电机功率 kW",
  `no2_mp_speed_rpm` double NULL COMMENT "2#主推电机转速 RPM",
  `me_cons_corr_mt` double NULL COMMENT "主机日耗油量_修正（吨）",
  `ae_cons_corr_mt` double NULL COMMENT "发电机组总日耗油量_修正（吨）",
  `boiler_cons_corr_mt` double NULL COMMENT "锅炉总日耗油量_修正（吨）",
  `total_fo_cons_corr_mt` double NULL COMMENT "总日耗油量_修正（吨）",
  `me_cons_corr_mt_24h` double NULL COMMENT "主机日耗油量_修正_24h（吨）",
  `ae_cons_corr_mt_24h` double NULL COMMENT "发电机组总日耗油量_修正_24h（吨）",
  `battery_cons` double NULL COMMENT "耗电量",
  `battery_remain` double NULL COMMENT "剩余电量",
  `charging_capacity` double NULL COMMENT "充电量",
  `charging_times` double NULL COMMENT "充电次数",
  `charging_time` double NULL COMMENT "充电时间 h",
  `discharging_time` double NULL COMMENT "放电时间 h",
  `operation_times` int NULL COMMENT "作业次数",
  `operation_time` double NULL COMMENT "作业时间 h",
  `update_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT "更新时间",
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT "创建时间",
  `is_done` int NULL COMMENT "是否计算",
  `fuel_all_cons_mt` double NULL COMMENT "全船燃油总消耗"
) ENGINE=OLAP
UNIQUE KEY(`ship_code`, `noonreport_date`, `first_data_utctime`)
DISTRIBUTED BY HASH(`ship_code`, `noonreport_date`) BUCKETS 16
PROPERTIES (
"replication_allocation" = "tag.location.default: 1",
"min_load_replica_num" = "-1",
"is_being_synced" = "false",
"storage_medium" = "hdd",
"storage_format" = "V2",
"inverted_index_storage_format" = "V1",
"enable_unique_key_merge_on_write" = "true",
"light_schema_change" = "true",
"disable_auto_compaction" = "false",
"enable_single_replica_compaction" = "false",
"group_commit_interval_ms" = "10000",
"group_commit_data_bytes" = "134217728",
"enable_mow_light_delete" = "false"
);

-- Table: ods_ship_raw_data_d
CREATE TABLE `ods_ship_raw_data_d` (
  `ship_code` varchar(50) NULL COMMENT "船舶编码",
  `timestamp` bigint NULL COMMENT "时间戳 10位",
  `dt` date NULL COMMENT "分区字段 2025-08-02",
  `ship_status` int NULL COMMENT "船舶状态",
  `speed_knots` double NULL COMMENT "对地速度 kn",
  `meLoad_cal` double NULL COMMENT "主机负荷（计算值） %",
  `meLoad_rcs` double NULL COMMENT "主机负荷（计算值）备用 %",
  `me_ontime` double NULL COMMENT "主机燃油瞬时流量（计算值） kg/h",
  `aux_ontime` double NULL COMMENT "发电机组燃油瞬时流量（计算值） kg/h",
  `me_sum` double NULL COMMENT "主机燃油累计量  kg",
  `aux_sum` double NULL COMMENT "发电机组燃油累计量 kg",
  `boiler_ontime` double NULL COMMENT "锅炉燃油瞬时流量（计算值） kg/h",
  `lon` double NULL COMMENT "经度",
  `lat` double NULL COMMENT "纬度",
  `windspeed` double NULL COMMENT "风速_风速风向仪 m/s",
  `winddirection` double NULL COMMENT "风向_风速风向仪 °",
  `hdt` double NULL COMMENT "船艏向 °",
  `fore_draft` double NULL COMMENT "艏吃水 m",
  `aft_draft` double NULL COMMENT "艉吃水 m",
  `draft` double NULL COMMENT "平均吃水（计算值） m",
  `sliprate` double NULL COMMENT "滑失率（计算值） %",
  `rotation` double NULL COMMENT "轴转速 RPM",
  `course` double NULL COMMENT "航向 °",
  `shaft_power` double NULL COMMENT "轴功率 KW",
  `me_speed_rpm` double NULL COMMENT "主机转速 RPM",
  `me_fo_in_mass_total` double NULL COMMENT "主机燃油进口质量累积量 kg",
  `me_fo_out_mass_total` double NULL COMMENT "主机燃油出口质量累积量 kg",
  `dg_fo_in_mass_total` double NULL COMMENT "发电机燃油进口质量累积量 kg",
  `dg_fo_out_mass_total` double NULL COMMENT "发电机燃油出口质量累积量 kg",
  `stw` double NULL COMMENT "对水速度 kn",
  `me_cyl_1_exh_gas_out_temp` double NULL COMMENT "主机1号气缸排气温度 ℃",
  `me_cyl_2_exh_gas_out_temp` double NULL COMMENT "主机2号气缸排气温度 ℃",
  `me_cyl_3_exh_gas_out_temp` double NULL COMMENT "主机3号气缸排气温度 ℃",
  `me_cyl_4_exh_gas_out_temp` double NULL COMMENT "主机4号气缸排气温度 ℃",
  `me_cyl_5_exh_gas_out_temp` double NULL COMMENT "主机5号气缸排气温度 ℃",
  `me_cyl_6_exh_gas_out_temp` double NULL COMMENT "主机6号气缸排气温度 ℃",
  `me_cyl_7_exh_gas_out_temp` double NULL COMMENT "主机7号气缸排气温度 ℃",
  `ae_no1_power` double NULL COMMENT "1号发电机功率 KW",
  `ae_no2_power` double NULL COMMENT "2号发电机功率 KW",
  `ae_no3_power` double NULL COMMENT "3号发电机功率 KW",
  `ae_no4_power` double NULL COMMENT "4号发电机功率 KW",
  `ae_no1_load` double NULL COMMENT "1号发电机负荷 %",
  `ae_no2_load` double NULL COMMENT "2号发电机负荷 %",
  `ae_no3_load` double NULL COMMENT "3号发电机负荷 %",
  `ae_no4_load` double NULL COMMENT "4号发电机负荷 %",
  `boiler_sum` double NULL COMMENT "锅炉燃油消耗累积量 kg",
  `boiler_running` int NULL COMMENT "锅炉开关",
  `no1_box_battery_cons` double NULL COMMENT "1#箱式电源耗电量 kWh",
  `no2_box_battery_cons` double NULL COMMENT "2#箱式电源耗电量 kWh",
  `no3_box_battery_cons` double NULL COMMENT "3#箱式电源耗电量 kWh",
  `no1_mp_power` double NULL COMMENT "1#主推电机功率 kW",
  `no1_mp_speed_rpm` double NULL COMMENT "1#主推电机转速 RPM",
  `no2_mp_power` double NULL COMMENT "2#主推电机功率 kW",
  `no2_mp_speed_rpm` double NULL COMMENT "2#主推电机转速 RPM",
  `etl_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT "入库时间",
  `fuel_all_cons_mt` double NULL COMMENT "全船瞬时燃油总消耗"
) ENGINE=OLAP
UNIQUE KEY(`ship_code`, `timestamp`, `dt`)
COMMENT '船舶原始数据表'
PARTITION BY RANGE(`dt`)
(PARTITION p202102 VALUES [('2021-02-01'), ('2021-03-01')),
PARTITION p202103 VALUES [('2021-03-01'), ('2021-04-01')),
PARTITION p202104 VALUES [('2021-04-01'), ('2021-05-01')),
PARTITION p202105 VALUES [('2021-05-01'), ('2021-06-01')),
PARTITION p202106 VALUES [('2021-06-01'), ('2021-07-01')),
PARTITION p202107 VALUES [('2021-07-01'), ('2021-08-01')),
PARTITION p202108 VALUES [('2021-08-01'), ('2021-09-01')),
PARTITION p202109 VALUES [('2021-09-01'), ('2021-10-01')),
PARTITION p202110 VALUES [('2021-10-01'), ('2021-11-01')),
PARTITION p202111 VALUES [('2021-11-01'), ('2021-12-01')),
PARTITION p202112 VALUES [('2021-12-01'), ('2022-01-01')),
PARTITION p202201 VALUES [('2022-01-01'), ('2022-02-01')),
PARTITION p202202 VALUES [('2022-02-01'), ('2022-03-01')),
PARTITION p202203 VALUES [('2022-03-01'), ('2022-04-01')),
PARTITION p202204 VALUES [('2022-04-01'), ('2022-05-01')),
PARTITION p202205 VALUES [('2022-05-01'), ('2022-06-01')),
PARTITION p202206 VALUES [('2022-06-01'), ('2022-07-01')),
PARTITION p202207 VALUES [('2022-07-01'), ('2022-08-01')),
PARTITION p202208 VALUES [('2022-08-01'), ('2022-09-01')),
PARTITION p202209 VALUES [('2022-09-01'), ('2022-10-01')),
PARTITION p202210 VALUES [('2022-10-01'), ('2022-11-01')),
PARTITION p202211 VALUES [('2022-11-01'), ('2022-12-01')),
PARTITION p202212 VALUES [('2022-12-01'), ('2023-01-01')),
PARTITION p202301 VALUES [('2023-01-01'), ('2023-02-01')),
PARTITION p202302 VALUES [('2023-02-01'), ('2023-03-01')),
PARTITION p202303 VALUES [('2023-03-01'), ('2023-04-01')),
PARTITION p202304 VALUES [('2023-04-01'), ('2023-05-01')),
PARTITION p202305 VALUES [('2023-05-01'), ('2023-06-01')),
PARTITION p202306 VALUES [('2023-06-01'), ('2023-07-01')),
PARTITION p202307 VALUES [('2023-07-01'), ('2023-08-01')),
PARTITION p202308 VALUES [('2023-08-01'), ('2023-09-01')),
PARTITION p202309 VALUES [('2023-09-01'), ('2023-10-01')),
PARTITION p202310 VALUES [('2023-10-01'), ('2023-11-01')),
PARTITION p202311 VALUES [('2023-11-01'), ('2023-12-01')),
PARTITION p202312 VALUES [('2023-12-01'), ('2024-01-01')),
PARTITION p202401 VALUES [('2024-01-01'), ('2024-02-01')),
PARTITION p202402 VALUES [('2024-02-01'), ('2024-03-01')),
PARTITION p202403 VALUES [('2024-03-01'), ('2024-04-01')),
PARTITION p202404 VALUES [('2024-04-01'), ('2024-05-01')),
PARTITION p202405 VALUES [('2024-05-01'), ('2024-06-01')),
PARTITION p202406 VALUES [('2024-06-01'), ('2024-07-01')),
PARTITION p202407 VALUES [('2024-07-01'), ('2024-08-01')),
PARTITION p202408 VALUES [('2024-08-01'), ('2024-09-01')),
PARTITION p202409 VALUES [('2024-09-01'), ('2024-10-01')),
PARTITION p202410 VALUES [('2024-10-01'), ('2024-11-01')),
PARTITION p202411 VALUES [('2024-11-01'), ('2024-12-01')),
PARTITION p202412 VALUES [('2024-12-01'), ('2025-01-01')),
PARTITION p202501 VALUES [('2025-01-01'), ('2025-02-01')),
PARTITION p202502 VALUES [('2025-02-01'), ('2025-03-01')),
PARTITION p202503 VALUES [('2025-03-01'), ('2025-04-01')),
PARTITION p202504 VALUES [('2025-04-01'), ('2025-05-01')),
PARTITION p202505 VALUES [('2025-05-01'), ('2025-06-01')),
PARTITION p202506 VALUES [('2025-06-01'), ('2025-07-01')),
PARTITION p202507 VALUES [('2025-07-01'), ('2025-08-01')),
PARTITION p202508 VALUES [('2025-08-01'), ('2025-09-01')),
PARTITION p202509 VALUES [('2025-09-01'), ('2025-10-01')),
PARTITION p202510 VALUES [('2025-10-01'), ('2025-11-01')),
PARTITION p202511 VALUES [('2025-11-01'), ('2025-12-01')),
PARTITION p202512 VALUES [('2025-12-01'), ('2026-01-01')),
PARTITION p202601 VALUES [('2026-01-01'), ('2026-02-01')),
PARTITION p202602 VALUES [('2026-02-01'), ('2026-03-01')),
PARTITION p202603 VALUES [('2026-03-01'), ('2026-04-01')),
PARTITION p202604 VALUES [('2026-04-01'), ('2026-05-01')))
DISTRIBUTED BY HASH(`ship_code`, `timestamp`, `dt`) BUCKETS 10
PROPERTIES (
"replication_allocation" = "tag.location.default: 1",
"min_load_replica_num" = "-1",
"is_being_synced" = "false",
"dynamic_partition.enable" = "true",
"dynamic_partition.time_unit" = "MONTH",
"dynamic_partition.time_zone" = "Asia/Shanghai",
"dynamic_partition.start" = "-60",
"dynamic_partition.end" = "2",
"dynamic_partition.prefix" = "p",
"dynamic_partition.replication_allocation" = "tag.location.default: 1",
"dynamic_partition.buckets" = "10",
"dynamic_partition.create_history_partition" = "true",
"dynamic_partition.history_partition_num" = "-1",
"dynamic_partition.hot_partition_num" = "0",
"dynamic_partition.reserved_history_periods" = "NULL",
"dynamic_partition.storage_policy" = "",
"dynamic_partition.start_day_of_month" = "1",
"storage_medium" = "hdd",
"storage_format" = "V2",
"inverted_index_storage_format" = "V1",
"enable_unique_key_merge_on_write" = "true",
"light_schema_change" = "true",
"disable_auto_compaction" = "false",
"enable_single_replica_compaction" = "false",
"group_commit_interval_ms" = "10000",
"group_commit_data_bytes" = "134217728",
"enable_mow_light_delete" = "false"
);

-- Table: dwd_ship_voyage_details_d
CREATE TABLE `dwd_ship_voyage_details_d` (
  `ship_code` varchar(100) NULL COMMENT "船舶编号",
  `timestamp` bigint NULL COMMENT "时间戳",
  `dt` date NULL COMMENT "分区字段 2025-08-02",
  `beijing_time` datetime NULL COMMENT "北京时间",
  `utc_time` datetime NULL COMMENT "UTC 时间",
  `local_date` date NULL COMMENT "当地日期",
  `local_time` datetime NULL COMMENT "当地时间",
  `project_id` int NULL COMMENT "项目id 关联dim_ship_basic_info_d.project_id获取",
  `report_type` int NULL COMMENT "报告类型，关联dim_ship_basic_info_d.report_type获取",
  `vessel_name` varchar(100) NULL COMMENT "船舶英文名",
  `vessel_name_cn` varchar(100) NULL COMMENT "船舶中文名",
  `no1_dg_rated_power` decimal(10,3) NULL COMMENT "1号发电机额定功率(kW)",
  `no2_dg_rated_power` decimal(10,3) NULL COMMENT "2号发电机额定功率(kW)",
  `no3_dg_rated_power` decimal(10,3) NULL COMMENT "3号发电机额定功率(kW)",
  `no4_dg_rated_power` decimal(10,3) NULL COMMENT "4号发电机额定功率(kW)",
  `vessel_loading` text NULL COMMENT "船舶载重（标签）",
  `speed_knots` double NULL COMMENT "对地速度 kn",
  `stw` double NULL COMMENT "对水速度 kn",
  `rotation` double NULL COMMENT "轴转速 RPM",
  `me_speed_rpm` double NULL COMMENT "主机转速 RPM",
  `shaft_power` double NULL COMMENT "轴功率 KW",
  `meLoad_cal` double NULL COMMENT "主机负荷 %",
  `meLoad_rcs` double NULL COMMENT "主机负荷备用 %",
  `me_ontime` double NULL COMMENT "主机燃油瞬时流量 kg/h",
  `aux_ontime` double NULL COMMENT "发电机组燃油瞬时流量 kg/h",
  `me_sum` double NULL COMMENT "主机燃油累计量  kg",
  `aux_sum` double NULL COMMENT "发电机组燃油累计量 kg",
  `boiler_ontime` double NULL COMMENT "锅炉燃油瞬时流量 kg/h",
  `me_fo_in_mass_total` double NULL COMMENT "主机燃油进口质量累积 kg",
  `me_fo_out_mass_total` double NULL COMMENT "主机燃油出口质量累积 kg",
  `dg_fo_in_mass_total` double NULL COMMENT "发电机燃油进口质量累积 kg",
  `dg_fo_out_mass_total` double NULL COMMENT "发电机燃油出口质量累积 kg",
  `boiler_sum` double NULL COMMENT "锅炉燃油消耗累积 kg",
  `fore_draft` double NULL COMMENT "艏吃水 m",
  `aft_draft` double NULL COMMENT "艉吃水 m",
  `draft` double NULL COMMENT "平均吃水 m",
  `lon` double NULL COMMENT "经度",
  `lat` double NULL COMMENT "纬度",
  `time_zone` int NULL COMMENT "时区",
  `windspeed` double NULL COMMENT "风速 m/s",
  `winddirection` double NULL COMMENT "风向 °",
  `hdt` double NULL COMMENT "船艏向 °",
  `course` double NULL COMMENT "航向 °",
  `sliprate` double NULL COMMENT "滑失率 %",
  `beaufort_scale` int NULL COMMENT "风力等级 BF",
  `sigwh` double NULL COMMENT "浪高 m",
  `wave_scale` int NULL COMMENT "浪高等级",
  `ocs` double NULL COMMENT "流速 kn",
  `ocd` varchar(20) NULL COMMENT "流向(going to) 16方向",
  `wsd` varchar(20) NULL COMMENT "海浪方向_WNI (Coming From)",
  `was` double NULL COMMENT "风速_WNI",
  `wad_come_from` varchar(20) NULL COMMENT "风向(coming from) 16方向",
  `pswh` double NULL COMMENT "涌浪高 m",
  `pswd` varchar(20) NULL COMMENT "涌浪方向(coming from) 16方向",
  `ssp` double NULL COMMENT "海面气压 pascal",
  `me_cyl_1_exh_gas_out_temp` double NULL COMMENT "主机1号缸排气温度 ℃",
  `me_cyl_2_exh_gas_out_temp` double NULL COMMENT "主机2号缸排气温度 ℃",
  `me_cyl_3_exh_gas_out_temp` double NULL COMMENT "主机3号缸排气温度 ℃",
  `me_cyl_4_exh_gas_out_temp` double NULL COMMENT "主机4号缸排气温度 ℃",
  `me_cyl_5_exh_gas_out_temp` double NULL COMMENT "主机5号缸排气温度 ℃",
  `me_cyl_6_exh_gas_out_temp` double NULL COMMENT "主机6号缸排气温度 ℃",
  `me_cyl_7_exh_gas_out_temp` double NULL COMMENT "主机7号缸排气温度 ℃",
  `ae_no1_power` double NULL COMMENT "1号发电机功率 KW",
  `ae_no2_power` double NULL COMMENT "2号发电机功率 KW",
  `ae_no3_power` double NULL COMMENT "3号发电机功率 KW",
  `ae_no4_power` double NULL COMMENT "4号发电机功率 KW",
  `ae_no1_load` double NULL COMMENT "1号发电机负荷 %",
  `ae_no2_load` double NULL COMMENT "2号发电机负荷 %",
  `ae_no3_load` double NULL COMMENT "3号发电机负荷 %",
  `ae_no4_load` double NULL COMMENT "4号发电机负荷 %",
  `boiler_running` int NULL COMMENT "锅炉开关量",
  `no1_box_battery_cons` double NULL COMMENT "1#箱式电源耗电量 kWh",
  `no2_box_battery_cons` double NULL COMMENT "2#箱式电源耗电量 kWh",
  `no3_box_battery_cons` double NULL COMMENT "3#箱式电源耗电量 kWh",
  `no1_mp_power` double NULL COMMENT "1#主推电机功率 kW",
  `no1_mp_speed_rpm` double NULL COMMENT "1#主推电机转速 RPM",
  `no2_mp_power` double NULL COMMENT "2#主推电机功率 kW",
  `no2_mp_speed_rpm` double NULL COMMENT "2#主推电机转速 RPM",
  `exlabel` text NULL COMMENT "异常字段名集合",
  `etl_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT "入库时间",
  `fuel_all_cons_mt` double NULL COMMENT "全船瞬时燃油总消耗"
) ENGINE=OLAP
UNIQUE KEY(`ship_code`, `timestamp`, `dt`)
COMMENT '船舶航行明细数据表'
PARTITION BY RANGE(`dt`)
(PARTITION p202102 VALUES [('2021-02-01'), ('2021-03-01')),
PARTITION p202103 VALUES [('2021-03-01'), ('2021-04-01')),
PARTITION p202104 VALUES [('2021-04-01'), ('2021-05-01')),
PARTITION p202105 VALUES [('2021-05-01'), ('2021-06-01')),
PARTITION p202106 VALUES [('2021-06-01'), ('2021-07-01')),
PARTITION p202107 VALUES [('2021-07-01'), ('2021-08-01')),
PARTITION p202108 VALUES [('2021-08-01'), ('2021-09-01')),
PARTITION p202109 VALUES [('2021-09-01'), ('2021-10-01')),
PARTITION p202110 VALUES [('2021-10-01'), ('2021-11-01')),
PARTITION p202111 VALUES [('2021-11-01'), ('2021-12-01')),
PARTITION p202112 VALUES [('2021-12-01'), ('2022-01-01')),
PARTITION p202201 VALUES [('2022-01-01'), ('2022-02-01')),
PARTITION p202202 VALUES [('2022-02-01'), ('2022-03-01')),
PARTITION p202203 VALUES [('2022-03-01'), ('2022-04-01')),
PARTITION p202204 VALUES [('2022-04-01'), ('2022-05-01')),
PARTITION p202205 VALUES [('2022-05-01'), ('2022-06-01')),
PARTITION p202206 VALUES [('2022-06-01'), ('2022-07-01')),
PARTITION p202207 VALUES [('2022-07-01'), ('2022-08-01')),
PARTITION p202208 VALUES [('2022-08-01'), ('2022-09-01')),
PARTITION p202209 VALUES [('2022-09-01'), ('2022-10-01')),
PARTITION p202210 VALUES [('2022-10-01'), ('2022-11-01')),
PARTITION p202211 VALUES [('2022-11-01'), ('2022-12-01')),
PARTITION p202212 VALUES [('2022-12-01'), ('2023-01-01')),
PARTITION p202301 VALUES [('2023-01-01'), ('2023-02-01')),
PARTITION p202302 VALUES [('2023-02-01'), ('2023-03-01')),
PARTITION p202303 VALUES [('2023-03-01'), ('2023-04-01')),
PARTITION p202304 VALUES [('2023-04-01'), ('2023-05-01')),
PARTITION p202305 VALUES [('2023-05-01'), ('2023-06-01')),
PARTITION p202306 VALUES [('2023-06-01'), ('2023-07-01')),
PARTITION p202307 VALUES [('2023-07-01'), ('2023-08-01')),
PARTITION p202308 VALUES [('2023-08-01'), ('2023-09-01')),
PARTITION p202309 VALUES [('2023-09-01'), ('2023-10-01')),
PARTITION p202310 VALUES [('2023-10-01'), ('2023-11-01')),
PARTITION p202311 VALUES [('2023-11-01'), ('2023-12-01')),
PARTITION p202312 VALUES [('2023-12-01'), ('2024-01-01')),
PARTITION p202401 VALUES [('2024-01-01'), ('2024-02-01')),
PARTITION p202402 VALUES [('2024-02-01'), ('2024-03-01')),
PARTITION p202403 VALUES [('2024-03-01'), ('2024-04-01')),
PARTITION p202404 VALUES [('2024-04-01'), ('2024-05-01')),
PARTITION p202405 VALUES [('2024-05-01'), ('2024-06-01')),
PARTITION p202406 VALUES [('2024-06-01'), ('2024-07-01')),
PARTITION p202407 VALUES [('2024-07-01'), ('2024-08-01')),
PARTITION p202408 VALUES [('2024-08-01'), ('2024-09-01')),
PARTITION p202409 VALUES [('2024-09-01'), ('2024-10-01')),
PARTITION p202410 VALUES [('2024-10-01'), ('2024-11-01')),
PARTITION p202411 VALUES [('2024-11-01'), ('2024-12-01')),
PARTITION p202412 VALUES [('2024-12-01'), ('2025-01-01')),
PARTITION p202501 VALUES [('2025-01-01'), ('2025-02-01')),
PARTITION p202502 VALUES [('2025-02-01'), ('2025-03-01')),
PARTITION p202503 VALUES [('2025-03-01'), ('2025-04-01')),
PARTITION p202504 VALUES [('2025-04-01'), ('2025-05-01')),
PARTITION p202505 VALUES [('2025-05-01'), ('2025-06-01')),
PARTITION p202506 VALUES [('2025-06-01'), ('2025-07-01')),
PARTITION p202507 VALUES [('2025-07-01'), ('2025-08-01')),
PARTITION p202508 VALUES [('2025-08-01'), ('2025-09-01')),
PARTITION p202509 VALUES [('2025-09-01'), ('2025-10-01')),
PARTITION p202510 VALUES [('2025-10-01'), ('2025-11-01')),
PARTITION p202511 VALUES [('2025-11-01'), ('2025-12-01')),
PARTITION p202512 VALUES [('2025-12-01'), ('2026-01-01')),
PARTITION p202601 VALUES [('2026-01-01'), ('2026-02-01')),
PARTITION p202602 VALUES [('2026-02-01'), ('2026-03-01')),
PARTITION p202603 VALUES [('2026-03-01'), ('2026-04-01')),
PARTITION p202604 VALUES [('2026-04-01'), ('2026-05-01')))
DISTRIBUTED BY HASH(`ship_code`, `timestamp`, `dt`) BUCKETS 10
PROPERTIES (
"replication_allocation" = "tag.location.default: 1",
"min_load_replica_num" = "-1",
"is_being_synced" = "false",
"dynamic_partition.enable" = "true",
"dynamic_partition.time_unit" = "MONTH",
"dynamic_partition.time_zone" = "Asia/Shanghai",
"dynamic_partition.start" = "-60",
"dynamic_partition.end" = "2",
"dynamic_partition.prefix" = "p",
"dynamic_partition.replication_allocation" = "tag.location.default: 1",
"dynamic_partition.buckets" = "10",
"dynamic_partition.create_history_partition" = "true",
"dynamic_partition.history_partition_num" = "-1",
"dynamic_partition.hot_partition_num" = "0",
"dynamic_partition.reserved_history_periods" = "NULL",
"dynamic_partition.storage_policy" = "",
"dynamic_partition.start_day_of_month" = "1",
"storage_medium" = "hdd",
"storage_format" = "V2",
"inverted_index_storage_format" = "V1",
"enable_unique_key_merge_on_write" = "true",
"light_schema_change" = "true",
"disable_auto_compaction" = "false",
"enable_single_replica_compaction" = "false",
"group_commit_interval_ms" = "10000",
"group_commit_data_bytes" = "134217728",
"enable_mow_light_delete" = "false"
);

-- Table: ship_mail_config
CREATE TABLE `ship_mail_config` (
  `project_code` varchar(20) NULL COMMENT "项目代码: WB(万邦), ZL(中联), WB_ALERT等",
  `ship_code` varchar(50) NULL COMMENT "船舶代码",
  `mail_type` varchar(20) NULL COMMENT "邮件类型: DAILY(每日午报), MONTHLY(每月午报)",
  `customer_name` varchar(100) NULL COMMENT "客户名称: IMC, 中联航运等",
  `sender` varchar(100) NULL COMMENT "发件人邮箱",
  `recipients` varchar(2000) NULL COMMENT "收件人邮箱，多个用逗号分隔",
  `cc_recipients` varchar(2000) NULL COMMENT "抄送人邮箱，多个用逗号分隔",
  `status` tinyint NULL DEFAULT "1" COMMENT "状态: 1-启用, 0-禁用",
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT "创建时间",
  `update_time` datetime NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT "更新时间"
) ENGINE=OLAP
UNIQUE KEY(`project_code`, `ship_code`, `mail_type`)
COMMENT '船舶项目邮件配置表'
DISTRIBUTED BY HASH(`project_code`) BUCKETS 10
PROPERTIES (
"replication_allocation" = "tag.location.default: 1",
"min_load_replica_num" = "-1",
"is_being_synced" = "false",
"storage_medium" = "hdd",
"storage_format" = "V2",
"inverted_index_storage_format" = "V1",
"enable_unique_key_merge_on_write" = "true",
"light_schema_change" = "true",
"disable_auto_compaction" = "false",
"enable_single_replica_compaction" = "false",
"group_commit_interval_ms" = "10000",
"group_commit_data_bytes" = "134217728",
"enable_mow_light_delete" = "false"
);

